<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link href="chatTestUpdated.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatTestUpdated.css') }}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
    
<link href='https://fonts.googleapis.com/css?family=Plus Jakarta Sans' rel='stylesheet'>
</head>
<body>
    <nav>
        
        <button id="openNav" >&#9776;</button>
        <div class="welcome">How can I help you,<div id="name"> <b>Maleek</b></div></div>
        <input id="youtube-url" placeholder="Enter your Youtube Url"/>
        
    </nav>
    <div class="chat">
        <div class="flex-container">

            <!-- <img class="something" src="/aipng.png" alt="" width="30" height="24" > -->
            <div class="outputPanel">
                <div class="mt-5" id="contentContainer" style="color: rgb(197, 196, 196)">
                    <!-- New content will be appended here -->
                  </div>
                  <div id="myModal" class="modal">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <img class="modal-content" id="img01">
                </div>
            </div>

        </div>

        <form id="prompt-form">
            <div class="wrapper">
              <input class="prompttext" placeholder="Type Your Prompt"/>
              <button type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"
                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                    <path d="M5 12l14 0"></path>
                    <path d="M13 18l6 -6"></path>
                    <path d="M13 6l6 6"></path>
                </svg>
              </button>
            </div>
        </form>
    </div>

    <!-- <div class="images-videos"> -->
      <div class="side-panel">
        <div class="section">
            <h2>Images</h2>
            <div class="images-container" id="images-container">
                {% for image in image_search_data %}
                <img src="{{ image.url }}" alt="Related Image" class="image-item">
                {% endfor %}
            </div>
            <button class="view-more-btn view-more-images-btn">+ View More</button>
        </div>
        <div class="section">
            <h2>Related Videos</h2>
            <div class="videos-container" id="videos-container">
                {% for video in video_search_data %}
                <div class="video-item" onclick="window.open('{{ video.url }}', '_blank')">
                    <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
                    <div class="video-info">
                        <p class="video-title">{{ video.title }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="view-more-btn view-more-videos-btn">+ View More</button>
        </div>
    </div>
    <!-- </div> -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
      
      document.getElementById('prompt-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const youtubeUrl = document.getElementById('youtube-url').value;
        const promptText = document.querySelector('.prompttext').value;
        
        
        
        const contentContainer = document.getElementById('contentContainer');
        let loading = document.createElement('div');
        loading.innerHTML = `<div id="loading">
          <span class="loading__dot"></span>
          <span class="loading__dot"></span>
          <span class="loading__dot"></span>
          </div>`;
          loading.id = 'loading';
          loading.classList.add('display');
          contentContainer.appendChild(loading);
          
          const response = await fetch('/generic', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              yturl: youtubeUrl,
              prompt: promptText
            })
          });
          
          const result = await response.json();
          loading.remove();
          
          displayContent(result);  // Do something with the result
        });
        
        // Retrieve the result from sessionStorage
        const result = JSON.parse(sessionStorage.getItem('result'));
        
        // Display the content
        displayContent(result);
        
        // Append new content to the contentContainer div
        function displayContent(data) {
          const contentContainer = document.getElementById('contentContainer');
          
          const contentBlock = document.createElement('div');
          contentBlock.className = 'content-block mb-3 p-3 typewriter';
          
          if (data.error) {
            contentBlock.innerHTML = `
            <h2 class="text-danger">Error</h2>
            <p class="typing-animation">${data.error}</p>
            `;
          } else {
            contentBlock.innerHTML = `
            <p class="typewriter">${data}</p>
            `;
          }
          
          contentContainer.appendChild(contentBlock);
          
          
        }
        //// new content
        function openModal(src) {
          var modal = document.getElementById("myModal");
          var modalImg = document.getElementById("img01");
          modal.style.display = "block";
          modalImg.src = src;
        }
        
        function closeModal() {
          var modal = document.getElementById("myModal");
          modal.style.display = "none";
        }
        
        
      </script>
      <script src="{{ url_for('static', filename='js/recommendation.js') }}"></script>
</body>
</html>